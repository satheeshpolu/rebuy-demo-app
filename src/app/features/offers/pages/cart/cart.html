<section class="cart">
  <header class="cart-head">
    <div class="title">
      <h1>{{ CONSTANTS.CART_TITLE }}</h1>
      <p class="muted">{{ count() }} item(s)</p>
    </div>

    @if (items().length > 0) {
      <button class="link danger" type="button" (click)="clear()">
        {{ CONSTANTS.CLEAR }}
      </button>
    }
  </header>

  <div class="grid" *ngIf="items().length; else empty">
    <main class="items">
      <article class="item" *ngFor="let item of items()">
        <img
          class="thumb"
          [src]="item.thumbnail"
          [alt]="item.title"
          loading="lazy"
          [routerLink]="['/offers', item.id]"
        />

        <div class="info">
          <div class="name">{{ item.title }}</div>
          <!-- <a class="btn ghost" [routerLink]="['/offers', item.id]">
            <mat-icon>open_in_new</mat-icon>
            {{ item.title }}
          </a> -->
          <discount-price
            [price]="item.price"
            [discountPercentage]="item.discountPercentage"
            currencySymbol="€"
          ></discount-price>

          <button class="link danger" type="button" (click)="remove(item.id)">
            <mat-icon aria-hidden="true">delete</mat-icon>
            {{ CONSTANTS.REMOVE }}
          </button>
        </div>

        <div class="qty">
          <button
            class="qty-btn"
            type="button"
            (click)="dec(item.id)"
            aria-label="Decrease quantity"
          >
            <mat-icon aria-hidden="true">remove</mat-icon>
          </button>

          <div class="qty-val">{{ item.quantity }}</div>

          <button
            class="qty-btn"
            type="button"
            (click)="inc(item.id)"
            aria-label="Increase quantity"
          >
            <mat-icon aria-hidden="true">add</mat-icon>
          </button>
        </div>

        <!-- <div class="line-total">
          {{ item.price * item.quantity | currency: 'EUR' : 'symbol' : '1.2-2' }}
        </div> -->
        <div class="line-total">
          {{ cart.getDiscountedPrice(item) * item.quantity | currency: 'EUR' : 'symbol' : '1.2-2' }}
        </div>
      </article>
    </main>

    <aside class="summary">
      <div class="card">
        <div class="card-head">
          <h2>Order summary</h2>
          <span class="chip">{{ count() }} items</span>
        </div>

        <div class="row">
          <span class="muted">Subtotal</span>
          <strong>{{ subtotal() | currency: 'EUR' : 'symbol' : '1.2-2' }}</strong>
        </div>

        <div class="row">
          <span class="muted">Shipping</span>
          <strong>
            <ng-container *ngIf="shipping() === 0; else shipCost">Free</ng-container>
            <ng-template #shipCost>{{
              shipping() | currency: 'EUR' : 'symbol' : '1.2-2'
            }}</ng-template>
          </strong>
        </div>

        <div class="divider"></div>

        <div class="row total">
          <span>Total</span>
          <strong>{{ total() | currency: 'EUR' : 'symbol' : '1.2-2' }}</strong>
        </div>

        <button class="btn primary" type="button" (click)="checkout()">
          {{ CONSTANTS.CHECKOUT }}<mat-icon aria-hidden="true">arrow_forward</mat-icon>
        </button>

        <button class="btn secondery" type="button" routerLink="/offers">
          <mat-icon aria-hidden="true">arrow_back</mat-icon>
          {{ CONSTANTS.CONTINUE_SHOPPING }}
        </button>

        <p class="fine">
          <mat-icon aria-hidden="true">verified</mat-icon>
          {{ CONSTANTS.CHECKOUT_MSG }}
        </p>
      </div>

      <div class="mobile-bar">
        <!-- <div>
          <div class="muted">Total</div>
          <div class="mobile-total">{{ total() | currency: 'EUR' : 'symbol' : '1.2-2' }}</div>
        </div> -->
        <button class="btn primary" type="button" (click)="checkout()">Checkout</button>
      </div>
    </aside>
  </div>

  <ng-template #empty>
    <empty-state
      icon="shopping_cart"
      title="Your cart is empty"
      description="Looks like you haven’t added anything yet."
      ctaIcon="local_offer"
      ctaLabel="Browse offers"
      ctaLink="/offers"
    />
  </ng-template>
</section>
